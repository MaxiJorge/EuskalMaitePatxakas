<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles - VitoMaite</title>
    <link rel="stylesheet" href="css/estilos.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=TU_API_KEY"></script>
</head>
<body>
    <header>
        <h2 class="nombre-app">VitoMaite</h2>
        <div class="perfil">
            <img src="img/default-profile.jpg" alt="Foto de perfil" class="foto-perfil">
            <button id="cerrarSesion">Cerrar Sesión</button>
            <button id="atras">Atrás</button>
        </div>
        <h1 class="titulo-busqueda">Detalles</h1>
    </header>

    <main>
        <section class="detalle-container">
            <h3>Información del Usuario</h3>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Edad</th>
                        <th>Género</th>
                        <th>Ciudad</th>
                        <th>Intereses</th>
                        <th>Ocupación</th>
                        <th>Correo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="nombre"></td>
                        <td id="edad"></td>
                        <td id="genero"></td>
                        <td id="ciudad"></td>
                        <td id="intereses"></td>
                        <td id="ocupacion"></td>
                        <td id="correo"></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="mapa" style="height: 500px;"></section>
    </main>

    <footer>
        <div>© 2024 VitoMaite. Todos los derechos reservados.</div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const usuarioId = sessionStorage.getItem('usuarioId');
            if (!usuarioId) {
                alert("No se encontró información del usuario.");
                window.location.href = 'buscarLogueado.html';
                return;
            }

            const request = indexedDB.open("VitoMaite", 1);

            request.onsuccess = function (event) {
                const db = event.target.result;
                cargarUsuario(db, parseInt(usuarioId));
            };

            function cargarUsuario(db, usuarioId) {
                const transaction = db.transaction("Usuarios", "readonly");
                const objectStore = transaction.objectStore("Usuarios");

                const request = objectStore.get(usuarioId);
                request.onsuccess = function (event) {
                    const usuario = event.target.result;
                    if (usuario) {
                        document.getElementById('nombre').textContent = usuario.nombre;
                        document.getElementById('edad').textContent = usuario.edad;
                        document.getElementById('genero').textContent = usuario.genero;
                        document.getElementById('ciudad').textContent = usuario.ciudad;
                        document.getElementById('intereses').textContent = usuario.intereses;
                        document.getElementById('ocupacion').textContent = usuario.ocupacion;
                        document.getElementById('correo').textContent = usuario.correo;

                        mostrarMapa(usuario);
                    } else {
                        alert("No se encontraron detalles para el usuario.");
                    }
                };
            }

            function mostrarMapa(usuario) {
                const mapa = new google.maps.Map(document.getElementById('mapa'), {
                    center: { lat: 43.04, lng: -2.67 }, // Centro aproximado del País Vasco
                    zoom: 8
                });

                // Coordenadas de las ciudades
                const ciudades = {
                    Donosti: { lat: 43.3183, lng: -1.9812 },
                    Bilbo: { lat: 43.2630, lng: -2.9349 },
                    Vitoria: { lat: 42.8460, lng: -2.6716 }
                };

                // Marcadores para las ciudades
                for (const ciudad in ciudades) {
                    new google.maps.Marker({
                        position: ciudades[ciudad],
                        map: mapa,
                        title: ciudad
                    });
                }

                // Marcador del usuario
                const usuarioPos = ciudades[usuario.ciudad] || { lat: 43.04, lng: -2.67 };
                new google.maps.Marker({
                    position: usuarioPos,
                    map: mapa,
                    title: usuario.nombre
                });
            }

            // Botón cerrar sesión
            document.getElementById('cerrarSesion').addEventListener('click', function () {
                alert('Sesión cerrada.');
                window.location.href = 'index.html';
            });

            // Botón atrás
            document.getElementById('atras').addEventListener('click', function () {
                window.location.href = 'buscarLogueado.html';
            });
        });
    </script>
</body>
</html>
